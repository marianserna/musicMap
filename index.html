<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>map</title>

    <style>
      body {
        box-sizing: border-box;
        margin: 0;
        overflow: hidden;
      }

      canvas {
        width: 100vw;
        height: 100vh;
      }
    </style>
  </head>
  <body>

    <canvas id="canvas"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r83/three.js"></script>
    <script src="js/vendor/OrbitControls.js"></script>
    <script src="js/Map.js"></script>
    <script src="js/Earth.js"></script>
    <script src="js/vendor/Map3dGeometry.js"></script>
    <script src="js/vendor/Projector.js"></script>

    <script type="text/javascript">

      fetch('/js/geo.json').then((response) => {
        return response.json();
      }).then((geoData) => {
        init(geoData);
      });

      function init(geoData) {
        const map = new Map();
        map.addLights();

        const planet = new Earth(geoData);
        map.scene.add(planet.globeMesh);

        map.addRayCasting(planet.globeMesh, (name) => {
          planet.colourCountry(name);
        });

        // Adding a wireframe
        // const sphereGeo = new THREE.SphereBufferGeometry(210, 10, 10);
        // const wireframe = new THREE.WireframeGeometry(sphereGeo);
        // const line = new THREE.LineSegments(wireframe);
        // line.material.depthTest = false;
        // line.material.opacity = 0.25;
        // line.material.transparent = true;
        //
        // scene.add(line);

        navigator.geolocation.getCurrentPosition((position) => {
          planet.addPoint(
            position.coords.latitude,
            position.coords.longitude
          );
        });

        requestAnimationFrame(render);

        function render() {
          map.renderer.render(map.scene, map.camera);
          planet.globeMesh.rotation.y += 0.001;
          requestAnimationFrame(render);
        }
      }

    </script>

  </body>
</html>
