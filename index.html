<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>map</title>

    <style>
      body {
        box-sizing: border-box;
        margin: 0;
      }

      #container {
        display: none;
      }

      #search {
        width: 50vw;
        min-height: 100vh;
      }

      #map-search {
        min-height: 100vh;
      }

      #canvas {
        height: 50vh;
      }

      #playlist {
        width: 50vw;
        height: 100vh;
      }
    </style>
  </head>
  <body>

    <div id="auth">
      <div class="login" onclick="db.signin()">
        <i class="fa fa-twitter fa-2x" aria-hidden="true"></i>
        <span>Log in with Twitter</span>
      </div>
    </div>

    <div id="container">

      <div id="search">
        <div id="name-search">
          <form id="name-search-form">
            <label for="name-search-input">Search</label>
            <input type="text" name="search" value="" id="name-search-input">
            <button type="search" name="button">Search</button>
          </form>
          
          <div id="name-search-results">
          </div>
        </div>

        <div id="map-search">
          <canvas id="canvas"></canvas>
        </div>
      </div>

      <div id="playlist">
        <h1>playlist here</h1>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/3.6.8/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r83/three.js"></script>
    <script src="js/Database.js"></script>
    <script src="js/vendor/OrbitControls.js"></script>
    <script src="js/Map.js"></script>
    <script src="js/Earth.js"></script>
    <script src="js/SoundCloud.js"></script>
    <script src="js/vendor/Map3dGeometry.js"></script>
    <script src="js/vendor/Projector.js"></script>
    <script src="https://connect.soundcloud.com/sdk/sdk-3.1.2.js"></script>
    <script src="https://use.fontawesome.com/036ff7566f.js"></script>

    <script>
      const sound = new SoundCloud();
      // sound.search('nutcracker');
    </script>

    <script>

      fetch('/js/geo.json').then((response) => {
        return response.json();
      }).then((geoData) => {
        init(geoData);
      });

      function init(geoData) {
        window.map = new Map();
        map.addLights();

        const planet = new Earth(geoData);
        map.scene.add(planet.globeMesh);

        map.addRayCasting(planet.globeMesh, (name) => {
          planet.colourCountry(name);
        });

        // Adding a wireframe
        // const sphereGeo = new THREE.SphereBufferGeometry(210, 10, 10);
        // const wireframe = new THREE.WireframeGeometry(sphereGeo);
        // const line = new THREE.LineSegments(wireframe);
        // line.material.depthTest = false;
        // line.material.opacity = 0.25;
        // line.material.transparent = true;
        //
        // scene.add(line);

        navigator.geolocation.getCurrentPosition((position) => {
          planet.addPoint(
            position.coords.latitude,
            position.coords.longitude
          );
        });

        requestAnimationFrame(render);

        function render() {
          map.renderer.render(map.scene, map.camera);
          planet.globeMesh.rotation.y += 0.001;
          requestAnimationFrame(render);
        }
      }

    </script>

    <script>
      const db = new Database();
      db.handleSignin();
    </script>

  </body>
</html>
